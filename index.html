<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Heiglhofstr. 64/66 Dorm FAQ</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 30px auto; max-width: 800px; line-height: 1.6; }
    h1, h2 { color: #222; }
    .section { margin-top: 2em; }
    .faq-item { background: #f8f8f8; margin: 8px 0; padding: 10px 14px; border-radius: 10px; }
    .faq-item summary { cursor: pointer; font-weight: 600; }
    input { width: 100%; padding: 8px; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>Heiglhofstr. 64/66 Dorm FAQ</h1>
  <input id="search" placeholder="Search all questions..." />

  <div id="faq-container"></div>

  <hr>
  <h2>Suggest a Question/Answer</h2>
  <p><a href="https://docs.google.com/forms/d/e/1FAIpQLSfjw4Cqqnu7wuLPSYZcjieyqE-dRdIOTKtVkbL3D7wRrEtmqA/viewform?usp=header" target="_blank">Submit a new question to the Heimrat Team</a></p>

  <!-- Include PapaParse library to parse CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    // Paste your published Google Sheet CSV link here
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRl3q0P2Zoy63eHZ1SKmuy5GxmhbU6SFVJA-5ZyBPkvOcoV8TbWm4Rj7Su4McjENTYHoPviIYCUNjWk/pub?gid=0&single=true&output=csv"; // Example: https://docs.google.com/spreadsheets/d/e/2PACX-xxxx/pub?output=csv

    let faqData = {}; // Object to store FAQs by section

    // Fetch and parse CSV dynamically
    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(row => {
          if(!row.Section) return; // skip empty rows
          if(!faqData[row.Section]) faqData[row.Section] = [];
          faqData[row.Section].push({q: row.Question, a: row.Answer});
        });
        renderFAQ(faqData); // initial render
      },
      error: function(err) {
        console.error("Error loading CSV:", err);
        document.getElementById('faq-container').innerHTML = "Failed to load FAQ data.";
      }
    });

    // Render FAQs into collapsible sections
    function renderFAQ(data) {
      const container = document.getElementById('faq-container');
      container.innerHTML = '';
      for (const [section, items] of Object.entries(data)) {
        const secDiv = document.createElement('div');
        secDiv.className = 'section';
        secDiv.innerHTML = `<h2>${section}</h2>`;
        items.forEach(item => {
          const el = document.createElement('details');
          el.className = 'faq-item';
          el.innerHTML = `<summary>${item.q}</summary><div>${item.a.replace(/\n/g, '<br>')}</div>`;
          secDiv.appendChild(el);
        });
        container.appendChild(secDiv);
      }
    }

    // Search functionality
    function searchFAQ(term) {
      term = term.toLowerCase();
      if (!term) { renderFAQ(faqData); return; }
      const filtered = {};
      for (const [section, items] of Object.entries(faqData)) {
        const hits = items.filter(i => i.q.toLowerCase().includes(term) || i.a.toLowerCase().includes(term));
        if (hits.length) filtered[section] = hits;
      }
      renderFAQ(filtered);
    }

    document.getElementById('search').addEventListener('input', e => searchFAQ(e.target.value));
  </script>
</body>
</html>
